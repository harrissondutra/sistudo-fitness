<div class="trainning-container">
  <div class="header">
    <mat-icon style="vertical-align: middle; margin-right: 8px;">fitness_center</mat-icon>
    <div class="header-content">
      <h1>{{ trainning?.name || 'Treino' }}</h1>
      <p class="subtitle">{{ trainning?.description }}</p>
    </div>
  </div>

  @if (trainning) {
  <div class="content">
    <!-- Informações do treino - sem alterações -->
    <div class="info-section">
      <h2>
        <mat-icon>info</mat-icon>
        Informações do Treino
      </h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Id:</span>
          <span class="value">{{ trainning.id }}</span>
        </div>
        <div class="info-item">
          <span class="label">Nome:</span>
          <span class="value">{{ trainning.name }}</span>
        </div>
        <div class="info-item">
          <span class="label">Descrição:</span>
          <span class="value">{{ trainning.description || 'Sem descrição' }}</span>
        </div>
        <div class="info-item">
          <span class="label">Cliente:</span>
          <span class="value">
            @if (trainning.client?.name) {
              {{ trainning.client.name }}
            } @else {
              Sem cliente associado
            }
          </span>
        </div>
        <div class="info-item">
          <span class="label">Data Inicial:</span>
          <span class="value">
            @if (trainning.startDate) {
              {{ formatDate(trainning.startDate) }}
            } @else {
              Não definida
            }
          </span>
        </div>
        <div class="info-item">
          <span class="label">Data Final:</span>
          <span class="value">
            @if (trainning.endDate) {
              {{ formatDate(trainning.endDate) }}
            } @else {
              Não definida
            }
          </span>
        </div>
        <div class="info-item">
          <span class="label">Status:</span>
          <span class="value">
            <mat-icon [color]="trainning.active ? 'primary' : 'warn'">
              {{ trainning.active ? 'check_circle' : 'cancel' }}
            </mat-icon>
            {{ trainning.active ? 'Ativo' : 'Inativo' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Seção de exercícios com edição -->
    @if (trainning?.exercises?.length) {
    <div class="exercises-section">
      <h2>
        <mat-icon>directions_run</mat-icon>
        Exercícios ({{ trainning.exercises.length }})
      </h2>

      <div class="exercises-list">
        @for (exercise of trainning.exercises; track exercise.id || $index) {
        <div class="exercise-item" [class.editing]="editingExercise?.id === exercise.id">
          <div class="exercise-header">
            <mat-icon class="exercise-icon">fitness_center</mat-icon>
            <div class="exercise-title">
              <h3>{{ exercise.name }}</h3>
              <p>{{ exercise.description || 'Sem descrição' }}</p>
            </div>
            <button mat-icon-button color="primary" (click)="toggleExerciseEdit(exercise)" class="edit-button"
                    matTooltip="{{ editingExercise?.id === exercise.id ? 'Salvar alterações' : 'Editar detalhes' }}">
              <mat-icon>{{ editingExercise?.id === exercise.id ? 'check' : 'edit' }}</mat-icon>
            </button>
          </div>

          <div class="exercise-metrics-container">
            <!-- Modo visualização -->
            @if (editingExercise?.id !== exercise.id) {
            <div class="exercise-metrics">
              <span class="metric"><strong>Séries:</strong> {{ exercise.sets || 0 }}</span>
              <span class="metric"><strong>Repetições:</strong> {{ exercise.repetitions || 0 }}</span>
              <span class="metric"><strong>Carga:</strong> {{ exercise.weight || 0 }}kg</span>
              <span class="metric"><strong>Descanso:</strong> {{ exercise.rest || 0 }}s</span>
            </div>
            }
            <!-- Modo edição -->
            @else {
            <div class="exercise-edit-form">
              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Séries</mat-label>
                  <input matInput type="number" [(ngModel)]="editingExercise.sets" min="0">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Repetições</mat-label>
                  <input matInput type="number" [(ngModel)]="editingExercise.repetitions" min="0">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Carga (kg)</mat-label>
                  <input matInput type="number" [(ngModel)]="editingExercise.weight" min="0">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Descanso (s)</mat-label>
                  <input matInput type="number" [(ngModel)]="editingExercise.rest" min="0">
                </mat-form-field>
              </div>

              <div class="action-buttons">
                <button mat-button color="warn" (click)="cancelExerciseEdit()">Cancelar</button>
                <button mat-raised-button color="primary" (click)="saveExerciseChanges()">Salvar</button>
              </div>
            </div>
            }
          </div>
        </div>
        }
      </div>
    </div>
    } @else {
    <div class="exercises-section">
      <h2>
        <mat-icon>directions_run</mat-icon>
        Exercícios
      </h2>
      <p class="no-exercises-message">Nenhum exercício adicionado a este treino.</p>
    </div>
    }
  </div>
  } @else {
  <div class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando treino ou treino não encontrado...</p>
  </div>
  }

  <!-- Botões de ação principais -->
  <div class="actions">
    <button mat-raised-button color="primary" [disabled]="!trainning"
      (click)="trainning && editTrainningById(trainning)">
      <mat-icon>edit</mat-icon>
      Editar
    </button>
    <button mat-raised-button color="warn" [disabled]="!trainning" (click)="trainning && onDelete(trainning)">
      <mat-icon>delete</mat-icon>
      Excluir
    </button>
    <button mat-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Voltar
    </button>
  </div>
</div>
