<!-- Container principal do calend√°rio -->
<div class="calendar-container">
  <!-- Cabe√ßalho -->
  <header class="agenda-header">
    <div class="agenda-header-content">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <h1 class="agenda-title" style="margin-bottom: 0;">
          <span class="agenda-emoji">üìÖ</span>
          <span>Agendamentos</span>
        </h1>
        <a [routerLink]="['/fit-agenda/create']" class="btn-new-appointment" title="Novo agendamento" style="margin-left:0.7rem;">
          <span class="material-icons">add</span>
          <span class="btn-new-label">Novo</span>
        </a>
      </div>



    </div>
    <div class="agenda-stats-and-btn">
      <div class="agenda-stats">
        <div class="stat-item">
          <span class="stat-number">{{ totalAppointments }}</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ availableSlotsToday }}</span>
          <span class="stat-label">Dispon√≠veis hoje</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Calend√°rio -->
  <div class="agenda-proximos-calendar">
    <ng-container *ngIf="eventsLoaded">
      <full-calendar #calendar [options]="calendarOptions"></full-calendar>
      <!-- For√ßa o CSS para quebra de linha e tooltip nos eventos -->
      <style>
        .fc-event-title {
          white-space: normal !important;
          word-break: normal !important;
          overflow-wrap: break-word !important;
          line-break: normal !important;
          hyphens: none !important;
        }
        .fc-event {
          cursor: pointer;
        }
        .custom-tooltip-event {
          position: absolute;
          z-index: 9999;
          background: #222;
          color: #fff;
          padding: 0.7em 1.1em;
          border-radius: 8px;
          font-size: 1rem;
          font-family: 'Montserrat', 'Roboto', sans-serif;
          box-shadow: 0 4px 16px rgba(0,0,0,0.18);
          pointer-events: none;
          min-width: 180px;
          max-width: 320px;
          white-space: pre-line;
        }
      </style>

    </ng-container>

  </div>

  <!-- Legenda -->
  <div class="calendar-legend">
    <h4>Legenda</h4>
    <div class="legend-items">
      <div class="legend-item" *ngFor="let status of legendStatus">
        <span class="legend-color" [ngStyle]="{ 'background-color': getStatusColor(status) }"></span>
        <span>{{ status | titlecase }}</span>
      </div>
    </div>
  </div>

  <!-- Modal de Detalhes do Evento -->
  <div class="modal-overlay" [ngClass]="{'visible': showModal}" (click)="closeModal($event)">
    <div class="event-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title-group">
          <i class="icon-calendar-check"></i>
          <!-- Use modalData.name diretamente no t√≠tulo -->
          <h3 *ngIf="!isEditing && modalData">{{ modalData.name }}</h3>
          <input *ngIf="isEditing && modalData" type="text" class="input-field" [(ngModel)]="modalData.name" placeholder="Nome do agendamento" />
        </div>
        <button class="close-button" (click)="closeModal(null)">
          <i class="icon-x"></i>
        </button>
      </div>
      <div class="modal-content">
        <div class="modal-info">
          <!-- Detalhes do agendamento -->
          <div class="info-row">
            <strong>Nome:</strong>
            <span>{{ modalData?.name }}</span>
          </div>
          <div class="info-row">
            <strong>Servi√ßo:</strong>
            <span *ngIf="!isEditing && modalData">{{ modalData.service }}</span>
            <select *ngIf="isEditing && modalData" class="input-field" [(ngModel)]="modalData.service">
              <option *ngFor="let s of serviceTypeOptions" [value]="s">{{ s }}</option>
            </select>
          </div>
          <div class="info-row">
            <strong>Status:</strong>
            <span *ngIf="!isEditing && modalData">{{ statusEdit | titlecase }}</span>
            <select *ngIf="isEditing && modalData" class="input-field" [(ngModel)]="statusEdit">
              <option *ngFor="let s of legendStatus" [value]="s">{{ s | titlecase }}</option>
            </select>
          </div>
          <div class="info-row">
            <strong>Descri√ß√£o:</strong>
            <span *ngIf="!isEditing && modalData">{{ modalData.description }}</span>
            <textarea *ngIf="isEditing && modalData" class="input-field" [(ngModel)]="modalData.description" placeholder="Descri√ß√£o"></textarea>
          </div>
          <div class="info-row">
            <strong>In√≠cio:</strong>
            <span *ngIf="!isEditing && modalData">{{ modalData.dateTime | date:'dd/MM/yyyy, HH:mm' }}</span>
            <input *ngIf="isEditing && modalData" type="datetime-local" class="input-field" [(ngModel)]="modalData.startString" />
          </div>
          <div class="info-row">
            <strong>Fim:</strong>
            <span *ngIf="!isEditing && modalData">{{ modalData.endDate | date:'dd/MM/yyyy, HH:mm' }}</span>
            <input *ngIf="isEditing && modalData" type="datetime-local" class="input-field" [(ngModel)]="modalData.endString" />
          </div>
        </div>
      </div>

      <!-- A√ß√µes -->
      <div class="modal-actions">
        <ng-container *ngIf="!isEditing">
          <button class="btn btn-primary" (click)="toggleEdit()"><i class="icon-edit"></i> Editar</button>
          <button class="btn btn-danger" (click)="handleDeleteAppointment()"><i class="icon-trash"></i> Excluir</button>
        </ng-container>
        <ng-container *ngIf="isEditing">
          <button class="btn btn-secondary" (click)="toggleEdit()"><i class="icon-x-circle"></i> Cancelar</button>
          <button class="btn btn-success" (click)="saveChanges()"><i class="icon-save"></i> Salvar</button>
        </ng-container>
      </div>
    </div>
  </div>
</div>
