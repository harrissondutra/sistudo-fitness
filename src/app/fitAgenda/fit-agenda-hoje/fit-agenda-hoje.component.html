<!-- Container principal do calend√°rio -->
<div class="calendar-container">
  <!-- Loading overlay -->
  <div class="loading-overlay" [class.visible]="isLoading">
    <div class="loading-spinner"></div>
    <p>Carregando agenda...</p>
  </div>

  <!-- Header padr√£o do sistema -->
  <header class="agenda-header">
    <div class="agenda-header-content">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <h1 class="agenda-title" style="margin-bottom: 0;">
          <span class="agenda-emoji">üìÖ</span>
          <span>Agenda de Hoje</span>
        </h1>
      </div>
      <div class="agenda-date">
        {{ today | date:'dd/MM/yyyy, EEEE' : '' : 'pt-BR' }}
      </div>
    </div>
    <div class="agenda-stats-and-btn">
      <div class="agenda-stats">
        <div class="stat-item">
          <span class="stat-number">{{ eventCount }}</span>
          <span class="stat-label">Agendamentos</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ freeSlots }}</span>
          <span class="stat-label">Dispon√≠vel</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Calend√°rio -->
  <div class="agenda-calendar">
    <full-calendar
      #calendar
      [options]="calendarOptions"
    ></full-calendar>
  </div>

  <!-- Legenda de cores -->
  <div class="calendar-legend">
    <h4>Tipos de Servi√ßo</h4>
    <div class="legend-items">
      <div class="legend-item">
        <span class="legend-color" style="background: #1976d2;"></span>
        <span>Consulta</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #388e3c;"></span>
        <span>Avalia√ß√£o</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #f57c00;"></span>
        <span>Treino</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #7b1fa2;"></span>
        <span>Nutri√ß√£o</span>
      </div>
    </div>
  </div>

  <!-- Modal de detalhes do evento -->
  <div class="modal-overlay" [class.visible]="showModal" (click)="closeModal()">
    <div class="event-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title-group">
          <i class="icon-calendar-check"></i>
          <h3>Detalhes do Agendamento</h3>
        </div>
        <button class="close-button" (click)="closeModal()">
          <i class="icon-close">√ó</i>
        </button>
      </div>

      <div class="modal-content" *ngIf="selectedEvent">
        <div class="event-info">
          <div class="info-row">
            <strong>Cliente:</strong>
            <span *ngIf="!isEditing">{{ selectedEvent.title }}</span>
            <input
              *ngIf="isEditing"
              type="text"
              [(ngModel)]="editingEvent!.title"
              class="edit-input"
              placeholder="Nome do cliente">
          </div>
          <div class="info-row">
            <strong>Servi√ßo:</strong>
            <span *ngIf="!isEditing" class="service-badge">{{ selectedEvent.service || 'N√£o informado' }}</span>
            <select
              *ngIf="isEditing"
              [(ngModel)]="editingEvent!.service"
              class="edit-select">
              <option value="">Selecione um servi√ßo</option>
              <option value="consulta">Consulta</option>
              <option value="avaliacao">Avalia√ß√£o</option>
              <option value="treino">Treino</option>
              <option value="nutricao">Nutri√ß√£o</option>
            </select>
          </div>
          <div class="info-row">
            <strong>Descri√ß√£o:</strong>
            <span *ngIf="!isEditing">{{ selectedEvent.description || 'N√£o informado' }}</span>
            <textarea
              *ngIf="isEditing"
              [(ngModel)]="editingEvent!.description"
              class="edit-textarea"
              placeholder="Descri√ß√£o do agendamento"
              rows="3"></textarea>
          </div>
          <div class="info-row">
            <strong>Hor√°rio:</strong>
            <span *ngIf="!isEditing">{{ formatDateTime(selectedEvent.start) }} - {{ formatDateTime(selectedEvent.end) }}</span>
            <div *ngIf="isEditing" class="edit-time-group">
              <div class="time-row">
                <label>In√≠cio:</label>
                <input
                  type="datetime-local"
                  [ngModel]="editingStartDatetime"
                  (ngModelChange)="editingStartDatetime = $event"
                  class="edit-datetime">
              </div>
              <div class="time-row">
                <label>Fim:</label>
                <input
                  type="datetime-local"
                  [ngModel]="editingEndDatetime"
                  (ngModelChange)="editingEndDatetime = $event"
                  class="edit-datetime">
              </div>
            </div>
          </div>
          <div class="info-row" *ngIf="selectedEvent.notes">
            <strong>Observa√ß√µes:</strong>
            <span>{{ selectedEvent.notes }}</span>
          </div>
        </div>

        <div class="modal-actions">
          <!-- Bot√µes no modo visualiza√ß√£o -->
          <ng-container *ngIf="!isEditing">
            <button class="btn-secondary" (click)="closeModal()">
              Fechar
            </button>
            <button class="btn-primary" (click)="startEditing()">
              Editar
            </button>
            <button class="btn-danger" (click)="deleteAppointment(+selectedEvent.id)">
              Excluir
            </button>
          </ng-container>

          <!-- Bot√µes no modo edi√ß√£o -->
          <ng-container *ngIf="isEditing">
            <button class="btn-secondary" (click)="cancelEditing()">
              Cancelar
            </button>
            <button class="btn-primary" (click)="saveEditing()">
              Salvar
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>
