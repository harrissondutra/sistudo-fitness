<div class="measures-container">
  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Carregando medidas do cliente...</p>
    </div>
  } @else if (error || !client) {
    <div class="error-container">
      <mat-icon>error_outline</mat-icon>
      <h2>Erro ao carregar medidas</h2>
      <p>Cliente não encontrado ou ocorreu um erro ao carregar os dados.</p>
      <button mat-raised-button color="primary" (click)="onBack()">
        <mat-icon>arrow_back</mat-icon>
        Voltar
      </button>
    </div>
  } @else {
    <!-- CABEÇALHO -->
    <div class="page-header">
      <div class="header-content">
        <div class="client-info">
          <div class="client-avatar">
            @if (client.evolutionPhotos?.length) {
              <img [src]="client.evolutionPhotos?.[0]" [alt]="client.name + ' - Foto'">
            } @else {
              <mat-icon>person</mat-icon>
            }
          </div>
          <div class="client-details">
            <h1 class="page-title">Medidas Corporais</h1>
            <p class="client-name">{{ client.name }}</p>
            <p class="measures-info">Acompanhamento de medidas e evolução</p>
          </div>
        </div>
        <div class="header-actions">
          @if (!isEditing) {
            <button mat-raised-button color="accent" (click)="enableEditing()">
              <mat-icon>edit</mat-icon>
              {{ measures ? 'Editar Medidas' : 'Adicionar Medidas' }}
            </button>
          } @else {
            <button
              mat-raised-button
              class="save-button"
              (click)="saveMeasures()"
              [disabled]="isSaving || !hasChanges()">
              @if (isSaving) {
                <mat-spinner class="loading-spinner" diameter="16"></mat-spinner>
              } @else {
                <mat-icon>save</mat-icon>
              }
              {{ isSaving ? 'Salvando...' : 'Salvar' }}
            </button>
            <button
              mat-raised-button
              class="cancel-button"
              (click)="cancelEditing()"
              [disabled]="isSaving">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
          }
          <button mat-icon-button (click)="onBack()" matTooltip="Voltar ao Dashboard">
            <mat-icon>arrow_back</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- ESTATÍSTICAS RÁPIDAS -->
    <div class="stats-grid">
      <div class="stat-card weight">
        <div class="stat-icon">
          <mat-icon>scale</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ client.weight || '-' }}</span>
          <span class="stat-label">Peso (kg)</span>
        </div>
      </div>

      <div class="stat-card height">
        <div class="stat-icon">
          <mat-icon>straighten</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ client.height || '-' }}</span>
          <span class="stat-label">Altura (cm)</span>
        </div>
      </div>

      <div class="stat-card bmi">
        <div class="stat-icon">
          <mat-icon>analytics</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ getBMI() || '-' }}</span>
          <span class="stat-label">IMC</span>
        </div>
      </div>
    </div>

    <!-- SEÇÃO DE MEDIDAS DETALHADAS -->
    <div class="measures-section">
      <div class="section-header">
        <h2>
          <mat-icon>straighten</mat-icon>
          Medidas Detalhadas
        </h2>
        <p>{{ measures ? 'Circunferências corporais atuais' : 'Adicione as medidas corporais do cliente' }}</p>
      </div>

      <div class="measures-grid">
        <!-- Medidas do Tronco -->
        <mat-card class="measure-group-card">
          <mat-card-header>
            <div class="group-avatar tronco">
              <mat-icon>accessibility</mat-icon>
            </div>
            <mat-card-title>Tronco</mat-card-title>
            <mat-card-subtitle>Medidas da região do tronco</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="measures-list">
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Ombro</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.ombro"
                           min="0" max="300">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.ombro || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Peitoral</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.peitoral"
                           min="0" max="300">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.peitoral || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Cintura</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.cintura"
                           min="0" max="300">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.cintura || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Quadril</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.quadril"
                           min="0" max="300">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.quadril || '-' }} cm</span>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Medidas dos Braços -->
        <mat-card class="measure-group-card">
          <mat-card-header>
            <div class="group-avatar bracos">
              <mat-icon>fitness_center</mat-icon>
            </div>
            <mat-card-title>Braços</mat-card-title>
            <mat-card-subtitle>Circunferências dos braços</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="measures-list">
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Braço Direito</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.braco_direito"
                           min="0" max="100">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.braco_direito || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Braço Esquerdo</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.braco_esquerdo"
                           min="0" max="100">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.braco_esquerdo || '-' }} cm</span>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Medidas das Pernas -->
        <mat-card class="measure-group-card">
          <mat-card-header>
            <div class="group-avatar pernas">
              <mat-icon>directions_run</mat-icon>
            </div>
            <mat-card-title>Pernas</mat-card-title>
            <mat-card-subtitle>Circunferências das coxas e panturrilhas</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="measures-list">
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Coxa Direita</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.coxa_direita"
                           min="0" max="150">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.coxa_direita || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Coxa Esquerda</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.coxa_esquerda"
                           min="0" max="150">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.coxa_esquerda || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Panturrilha Direita</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.panturrilha_direita"
                           min="0" max="100">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.panturrilha_direita || '-' }} cm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Panturrilha Esquerda</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="cm"
                           [(ngModel)]="editableMeasures.panturrilha_esquerda"
                           min="0" max="100">
                    <span matSuffix>cm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.panturrilha_esquerda || '-' }} cm</span>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Dobras Cutâneas -->
        <mat-card class="measure-group-card">
          <mat-card-header>
            <div class="group-avatar dobras">
              <mat-icon>compress</mat-icon>
            </div>
            <mat-card-title>Dobras Cutâneas</mat-card-title>
            <mat-card-subtitle>Medidas de gordura corporal</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="measures-list">
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Subescapular</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="mm"
                           [(ngModel)]="editableMeasures.subescapular"
                           min="0" max="100">
                    <span matSuffix>mm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.subescapular || '-' }} mm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Tríceps</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="mm"
                           [(ngModel)]="editableMeasures.triceps"
                           min="0" max="100">
                    <span matSuffix>mm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.triceps || '-' }} mm</span>
                }
              </div>
              <div class="measure-item">
                <div class="measure-info">
                  <mat-icon>straighten</mat-icon>
                  <span class="measure-name">Abdominal</span>
                </div>
                @if (isEditing) {
                  <mat-form-field appearance="outline" class="measure-input">
                    <input matInput type="number" placeholder="mm"
                           [(ngModel)]="editableMeasures.abdominal"
                           min="0" max="100">
                    <span matSuffix>mm</span>
                  </mat-form-field>
                } @else {
                  <span class="measure-value">{{ editableMeasures.abdominal || '-' }} mm</span>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- IMC e Análise -->
        <mat-card class="measure-group-card analysis-card">
          <mat-card-header>
            <div class="group-avatar analysis" [style.background-color]="getBMIColor()">
              <mat-icon>analytics</mat-icon>
            </div>
            <mat-card-title>Análise IMC</mat-card-title>
            <mat-card-subtitle>Índice de Massa Corporal</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="bmi-analysis">
              <div class="bmi-value">
                <span class="bmi-number">{{ getBMI() || '-' }}</span>
                <span class="bmi-unit">kg/m²</span>
              </div>
              @if (getBMI()) {
                <div class="bmi-category" [style.color]="getBMIColor()">
                  <mat-icon class="bmi-status-icon">{{ getBMIStatusIcon() }}</mat-icon>
                  <span class="bmi-category-text">{{ getBMICategoryForDisplay() }}</span>
                </div>
              } @else {
                <div class="bmi-category">
                  <span class="bmi-category-text">Dados insuficientes para calcular IMC</span>
                </div>
              }
              <div class="bmi-description">
                <p>IMC calculado com base no peso e altura atuais</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  }
</div>
