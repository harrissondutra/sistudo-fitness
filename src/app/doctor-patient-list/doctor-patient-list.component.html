<div class="doctor-patient-list-container">
  <!-- Header com informações do médico -->
  <mat-toolbar class="doctor-header">
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    
    <div class="doctor-info">
      @if (doctorInfo) {
        <div class="doctor-details">
          <h1 class="doctor-name">Dr. {{ doctorInfo.name }}</h1>
          <p class="doctor-specialty">{{ doctorInfo.specialty || 'Médico' }}</p>
        </div>
      } @else {
        <div class="doctor-details">
          <h1 class="doctor-name">Pacientes do Médico</h1>
        </div>
      }
    </div>

    <div class="header-actions">
      <mat-chip-set>
        <mat-chip highlighted>
          <mat-icon>people</mat-icon>
          {{ clients.length }} {{ clients.length === 1 ? 'Paciente' : 'Pacientes' }}
        </mat-chip>
      </mat-chip-set>
    </div>
  </mat-toolbar>

  <!-- Conteúdo principal -->
  <div class="content">
    @if (loading) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p class="loading-text">Carregando lista de pacientes...</p>
      </div>
    } @else if (error) {
      <div class="error-container">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <h3>Ops! Algo deu errado</h3>
        <p>{{ error }}</p>
        <button mat-raised-button color="primary" (click)="loadClients()">
          <mat-icon>refresh</mat-icon>
          Tentar Novamente
        </button>
      </div>
    } @else if (clients.length === 0) {
      <div class="empty-state">
        <mat-icon class="empty-icon">person_outline</mat-icon>
        <h3>Nenhum paciente encontrado</h3>
        <p>Este médico ainda não possui pacientes associados.</p>
        <button mat-raised-button color="primary" routerLink="/clients-list">
          <mat-icon>add</mat-icon>
          Ver Todos os Clientes
        </button>
      </div>
    } @else {
      <!-- Lista de pacientes -->
      <div class="patients-grid">
        @for (client of clients; track client.id) {
          <mat-card class="patient-card">
            <div class="card-header">
              @if (client.evolutionPhotos && client.evolutionPhotos.length > 0) {
                <div class="patient-avatar">
                  <img [src]="client.evolutionPhotos[0]" [alt]="client.name" />
                </div>
              } @else {
                <div class="patient-avatar placeholder">
                  <mat-icon>person</mat-icon>
                </div>
              }
              
              <div class="patient-basic-info">
                <h3 class="patient-name">{{ client.name }}</h3>
                <div class="patient-meta">
                  @if (client.dateOfBirth) {
                    <span class="age">{{ calculateAge(client.dateOfBirth.toString()) }} anos</span>
                  }
                  @if (client.weight && client.height) {
                    <span class="gender">{{ client.weight }}kg • {{ client.height }}cm</span>
                  }
                </div>
              </div>
            </div>

            <mat-divider></mat-divider>

            <mat-card-content class="patient-details">
              @if (client.email) {
                <div class="detail-item">
                  <mat-icon>email</mat-icon>
                  <span>{{ client.email }}</span>
                </div>
              }
              
              @if (client.phone) {
                <div class="detail-item">
                  <mat-icon>phone</mat-icon>
                  <span>{{ client.phone }}</span>
                </div>
              }
              
              @if (client.cpf) {
                <div class="detail-item">
                  <mat-icon>badge</mat-icon>
                  <span>CPF: {{ client.cpf }}</span>
                </div>
              }

              <div class="assistance-info">
                @if (client.hasDoctorAssistance) {
                  <mat-chip class="assistance-chip doctor">
                    <mat-icon>medical_services</mat-icon>
                    Médico
                  </mat-chip>
                }
                @if (client.hasPersonalAssistance) {
                  <mat-chip class="assistance-chip personal">
                    <mat-icon>fitness_center</mat-icon>
                    Personal
                  </mat-chip>
                }
                @if (client.hasNutritionistAssistance) {
                  <mat-chip class="assistance-chip nutritionist">
                    <mat-icon>restaurant</mat-icon>
                    Nutricionista
                  </mat-chip>
                }
              </div>
            </mat-card-content>

            <mat-divider></mat-divider>

            <mat-card-actions class="card-actions">
              <button mat-button (click)="viewClient(client.id!)" class="view-btn">
                <mat-icon>visibility</mat-icon>
                Visualizar
              </button>
              
              <button mat-button (click)="editClient(client.id!)" class="edit-btn">
                <mat-icon>edit</mat-icon>
                Editar
              </button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  </div>
</div>
